!function(t){var e={};function n(i){if(e[i])return e[i].exports;var o=e[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(i,o,function(e){return t[e]}.bind(null,o));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){t.exports=n(8)},function(t,e,n){},function(t,e,n){},function(t,e,n){},function(t,e,n){},function(t,e,n){},function(t,e,n){},function(t,e,n){},function(t,e,n){"use strict";n.r(e);n(1);const i=t=>{new Date;let e=500,n=performance.now()+e,i=0,o=0;requestAnimationFrame(function a(){o=n-performance.now(),window.scrollTo(0,t*(1-Math.pow(o/e,2))),i=requestAnimationFrame(a),o<=0&&(window.scrollTo(0,t),cancelAnimationFrame(i))})};n(2);function o(t){document.title=t}class a{constructor(t,e){this.routers=t,this.defaultPage=e,this.bodyElement=document.getElementById("out-put"),this.currentRouter={path:window.location.pathname.toLowerCase()};let n=this.routers.find(t=>t.path.test(this.getCurrentBrowserPath()));null==n&&(n=this.routers[0]),n.page.renderBodyAfter();let i=this.bodyElement.nextElementSibling;i.style.opacity="0",this.show(1e3,i),document.body.addEventListener("click",t=>{let e=t.composedPath().find(t=>"ROUTER"==t.tagName);null!=e&&this.notify(e.dataset.href)}),window.onpopstate=t=>{this.notify(this.getCurrentBrowserPath(),!0)}}push(t,e=""){window.history.pushState(null,e,t)}back(){window.history.back()}forward(){window.history.forward()}go(t){window.history.go(t)}notify(t,e=!1){if(null==t)return;let n=document.title;if(o("正在努力加载... | Kaakira"),(t=t.toLowerCase())===this.currentRouter.path)return void o(n);let i=this.routers.find(e=>e.path.test(t));if(!i)return;this.currentRouter.path=t,e||this.push(t);let a=this.bodyElement.nextElementSibling;this.hide(500,a);let r=document.createElement("div");r.classList.add("page-right"),r.style.opacity="0",this.bodyElement.after(r),i.page.renderBody().then(t=>{r.innerHTML=t,i.page.renderBodyAfter(),this.show(500,r)})}show(t,e){let n,i=performance.now()+t,o=()=>{let a=t-(i-performance.now()),r=this.easeInOut(a,0,1,t);if(a>=t)return e.style.opacity="1",void cancelAnimationFrame(n);e.style.opacity=r.toString(),n=requestAnimationFrame(o.bind(this))};o()}hide(t,e){let n,i=performance.now()+t,o=()=>{let a=t-(i-performance.now()),r=this.easeOut(a,0,1,t);if(a>=t)return e.remove(),void cancelAnimationFrame(n);e.style.opacity=(1-r).toString(),n=requestAnimationFrame(o.bind(this))};o()}easeInOut(t,e,n,i){return(t/=i/2)<1?n/2*t*t*t+e:n/2*((t-=2)*t*t+2)+e}easeOut(t,e,n,i){return-n*((t=t/i-1)*t*t*t-1)+e}getCurrentBrowserPath(){return window.location.pathname.toLowerCase()}}var r=function(t,e,n,i){return new(n||(n=Promise))(function(o,a){function r(t){try{l(i.next(t))}catch(t){a(t)}}function s(t){try{l(i.throw(t))}catch(t){a(t)}}function l(t){t.done?o(t.value):new n(function(e){e(t.value)}).then(r,s)}l((i=i.apply(t,e||[])).next())})};const s={UrlEncodeHeader:{"Content-Type":"application/x-www-form-urlencoded"},JsonHeader:{"Content-Type":"application/json"},ApiIndexPage:"/Index",ApiArticlePage:"/Article",ApiFriendPage:"/Friends",ApiPostComment:"/api/postComment",ApiPostCommentReply:"/api/postComment/reply"};function l(t,e=""){return r(this,void 0,void 0,function*(){if(t.ok){let e=t.headers.get("title");return e&&o(decodeURI(e).replace(/\+/g," ")),yield t.text()}return Promise.reject({result:"0",message:"服务器异常",data:null})})}function c(t,e=""){return r(this,void 0,void 0,function*(){if(t.ok){let e=t.headers.get("title");return e&&o(decodeURI(e).replace(/\+/g," ")),yield t.json()}return Promise.reject({result:"0",message:"服务器异常",data:null})})}const h={getIndexPage(t,e){return r(this,void 0,void 0,function*(){return l(yield fetch(s.ApiIndexPage+"?row="+t+"&page="+e,{method:"post",headers:s.UrlEncodeHeader}))})},getArticlePage(t){return r(this,void 0,void 0,function*(){return l(yield fetch(s.ApiArticlePage+"/"+t,{method:"post",headers:s.UrlEncodeHeader}))})},getFriendPage(){return r(this,void 0,void 0,function*(){return l(yield fetch(s.ApiFriendPage,{method:"post",headers:s.UrlEncodeHeader}))})}},d={postComment(t){return r(this,void 0,void 0,function*(){return c(yield fetch(s.ApiPostComment,{method:"post",headers:s.JsonHeader,body:JSON.stringify(t)}))})},postCommentReply(t){return r(this,void 0,void 0,function*(){return c(yield fetch(s.ApiPostCommentReply,{method:"post",headers:s.JsonHeader,body:JSON.stringify(t)}))})}};class m{renderBodyAfter(){}renderBody(){return h.getIndexPage(10,1).then(t=>t).catch(t=>(alert(t.message),null))}}n(3),n(4),n(5),n(6);class u{static getWrapper(){if(null==u.wrapper){new u;u.wrapper=document.createElement("div"),u.wrapper.classList.add("minimal-modal-wrapper"),u.wrapper.id="minimal-modal-wrapper",document.body.appendChild(u.wrapper)}return u.wrapper}static toast(t,e,n="info"){let i=u.getWrapper().childElementCount;if(1==i&&"操作过于频繁!"!=t)return void u.toast("操作过于频繁!",2e3,"warning");if(i>1)return;let o=document.createElement("div");o.classList.add("minimal-modal-item"),o.style.top=this.modalHeight*i+"px",o.innerHTML=`<div class="minimal-modal ${n}">${t}</div>`,u.getWrapper().appendChild(o),o.clientWidth;let a=o.firstChild;a.classList.add("show"),setTimeout(()=>{a.style.opacity="0",setTimeout(()=>{o.remove()},200)},e)}}u.modalHeight=60;class p{constructor(){this.replyType=0,this.pattern={email:/^([A-Za-z0-9_\-\.\u4e00-\u9fa5])+\@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,8})$/},this.commentFormWrapper=document.getElementById("minimal-comment"),this.commentMainForm=document.getElementById("comment-main-form"),this.commentElement=document.getElementById("comment"),this.commentElement.addEventListener("click",this.onReplyClick.bind(this)),this.nameText=document.getElementById("txt-name"),this.emailText=document.getElementById("txt-email"),this.websiteText=document.getElementById("txt-website"),this.contentText=document.getElementById("txt-content"),this.inputTexts=document.querySelectorAll(".minimal-group input"),this.inputTexts.forEach((t,e)=>{""!=t.value?t.classList.add("hasvalue"):t.classList.remove("hasvalue"),t.addEventListener("change",function(t){let e=t.target;""!=e.value?e.classList.add("hasvalue"):e.classList.remove("hasvalue")})}),this.btnReply=document.getElementById("post-comment"),this.btnReply.addEventListener("click",t=>{this.postComment(t.target)})}onReplyClick(t){let e=t.composedPath().find(t=>t.classList&&t.classList.contains("btn-reply"));if(null==e)return;let n=document.querySelector(".btn-reply.active");if(e.classList.contains("active"))n.classList.remove("active"),n.innerText="回复",this.replyType=0,e.classList.remove("active"),e.innerText="回复",this.commentMainForm.classList.remove("active"),this.commentFormWrapper.insertBefore(this.commentMainForm,this.commentFormWrapper.firstElementChild);else{null!=n&&(n.classList.remove("active"),n.innerText="回复"),e.classList.add("active"),this.commentMainForm.classList.add("active"),e.innerText="取消回复",this.replyType=1,t.composedPath().find(t=>t.classList&&(t.classList.contains("comment-post")||t.classList.contains("comment-reply"))).after(this.commentMainForm),this.reply={floorid:parseInt(e.dataset.floorid),replyid:parseInt(e.dataset.replyid),replyname:e.dataset.replyname}}}postComment(t){this.nameText.value?this.emailText.value?this.pattern.email.test(this.emailText.value)?this.contentText.value?0===this.replyType?d.postComment({content:this.contentText.value,email:this.emailText.value,name:this.nameText.value,website:this.websiteText.value,articleid:parseInt(t.dataset.article)}).then(t=>{u.toast("评论成功，后台审核中",2e3,"success")}).catch(t=>{u.toast("牙白...出现bug,评论失败",2e3,"error")}):d.postCommentReply({content:this.contentText.value,email:this.emailText.value,name:this.nameText.value,website:this.websiteText.value,floorid:this.reply.floorid,replyid:this.reply.replyid,replyname:this.reply.replyname}).then(t=>{u.toast("评论成功，后台审核中",2e3,"success")}).catch(t=>{u.toast("牙白...出现bug,评论失败",2e3,"error")}):u.toast("不会是忘记写评论了吧",2e3):u.toast("邮箱格式不正确",2e3):u.toast("邮箱不能为空",2e3):u.toast("写个昵称吧",2e3)}}class f{constructor(){this.anchorIndex=0}renderBody(){return this.anchorIndex=0,h.getArticlePage(location.pathname.split("/")[3]).then(t=>t).catch(t=>(alert(t.message),null))}renderBodyAfter(){new p;if(this.anchorList=document.querySelectorAll(".aticle-catalog-ul li a"),this.anchorList&&this.anchorList.length>0){this.anchorList[0].classList.add("active");let t=[];this.anchorList.forEach(e=>{t.push(document.querySelector("a[name="+e.hash.replace("#","")+"]").parentElement)}),window.onscroll=e=>{if(scrollY<=t[0].offsetTop)return this.anchorList[this.anchorIndex].classList.remove("active"),this.anchorList[0].classList.add("active"),void(this.anchorIndex=0);for(let e=0;e<this.anchorList.length;e++)if(e==this.anchorList.length-1||scrollY>=t[e].offsetTop&&scrollY<=t[e+1].offsetTop){if(this.anchorIndex==e)return;return this.anchorList[this.anchorIndex].classList.remove("active"),this.anchorList[e].classList.add("active"),void(this.anchorIndex=e)}}}}}class y{constructor(){this.lastTime=0,this.duration=3e3*Math.random()+5e3;let t=Math.random()/2;this.r=Math.ceil(30+30*t),this.g=Math.ceil(180+20*t),this.b=Math.ceil(235+25*t)}ToString(){let t=performance.now()/this.duration%2;t>1&&(t=2-t);let e=Math.ceil(this.g+30*t);return`#${Math.ceil(this.r+50*t).toString(16)}${e.toString(16)}${this.b.toString(16)}`}}class g{constructor(t){this.status=0,this.area={col:4,row:10},this.triangles=[],this.canvas=document.getElementById(t.id),this.context=this.canvas.getContext("2d"),this.area=t.area||this.area,this.canvas.height=this.canvas.clientHeight,this.canvas.width=this.canvas.clientWidth,this.height=this.canvas.height,this.width=this.canvas.width;let e=[],n=this.width/(this.area.col-1),i=this.height/(this.area.row-1);for(let t=0;t<this.area.col;t++){e[t]=[];for(let o=0;o<this.area.row;o++){let a={x:Math.min(t-1+t,this.area.col)*n+this.calcRandom(n),y:Math.min(o-1+o,this.area.row)*i+this.calcRandom(i),moveX:100*Math.random(),moveY:100*Math.random(),sx:0,sy:0,duration:3e3+3e3*Math.random()};a.sx=a.x,a.sy=a.y,e[t].push(a)}}for(let t=0;t<this.area.col-1;t++)for(let n=0;n<this.area.row-1;n++)this.triangles.push({color:new y,points:[e[t][n],e[t+1][n],e[t][n+1]]},{color:new y,points:[e[t][n+1],e[t+1][n],e[t+1][n+1]]});this.status=1,this.Update(1e3)}calcRandom(t){return(Math.random()>.4?1:-1)*Math.random()*t}Toggle(){1==this.status?(window.cancelAnimationFrame(this.reqID),this.status=0):(this.status=1,this.Update(performance.now()))}Update(t){1==this.status&&(this.context.beginPath(),this.context.fillStyle="#66ccff",this.context.fillRect(0,0,this.width,this.height),this.triangles.forEach((e,n)=>{this.DrawTriangle(e),this.moveEaseInOut(t,e.points)}),this.reqID=window.requestAnimationFrame(this.Update.bind(this)))}DrawTriangle(t){this.context.beginPath(),this.context.moveTo(t.points[0].x,t.points[0].y),this.context.lineTo(t.points[1].x,t.points[1].y),this.context.lineTo(t.points[2].x,t.points[2].y),this.context.fillStyle=t.color.ToString(),this.context.fill()}moveEaseInOut(t,e){for(let n of e){let e=t/n.duration%2;e<1?n.x=n.sx+n.moveX*this.makeEaseInOut2(e):(e-=1,n.x=n.sx+n.moveX*this.makeEaseInOut2(1-e))}}makeEaseInOut2(t){return t<.5?(t*=2,Math.pow(t,2)/2):(t=1-t,t*=2,1-Math.pow(t,2)/2)}}n(7);class v{renderBody(){return h.getFriendPage().then(t=>t).catch(t=>(alert(t.message),null))}renderBodyAfter(){}}!function(){new a([{path:/\/$/,page:new m},{path:/\/index$/,page:new m},{path:/\/article\/.+?\/\d+?$/,page:new f},{path:/\/friends$/,page:new v}],new m);document.getElementById("menu-routers").addEventListener("click",t=>{if(document.body.clientWidth<=768){null!=t.composedPath().find(t=>"ROUTER"==t.tagName)&&i(document.body.clientHeight)}});new g({id:"animation-board",area:{col:4,row:10}})}()}]);